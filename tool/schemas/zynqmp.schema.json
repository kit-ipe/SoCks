{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/zynqmp.schema.json",
  "title": "ZynqMP SoCks Project",
  "description": "Description of a ZynqMP SoCks project",
  "type": "object",
  "required": ["project", "externalTools", "blocks"],
  "additionalProperties": false,
  "properties": {
    "project": {
      "type": "object",
      "required": ["type", "name"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "description": "The unique identifier of the project type",
          "type": "string",
          "const": "zynqmp"
        },
        "name": {
          "description": "The name of the project",
          "type": "string",
          "pattern": "^[A-Za-z0-9-]*$"
        }
      }
    },
    "externalTools": {
      "type": "object",
      "required": ["xilinx", "make", "containerTool"],
      "additionalProperties": false,
      "properties": {
        "containerTool": {
          "description": "Container tool to be used [docker, podman]",
          "type": "string"
        },
        "make": {
          "type": "object",
          "required": ["maxBuildThreads"],
          "additionalProperties": false,
          "properties": {
            "maxBuildThreads": {
              "description": "Number of Makefile recipes to be execute simultaneously",
              "type": "number"
            }
          }
        },
        "xilinx": {
          "type": "object",
          "required": ["path", "version", "license"],
          "additionalProperties": false,
          "properties": {
            "path": {
              "description": "Path to the AMD Xilinx tool (Vivado, Vitis, ...)",
              "type": "string"
            },
            "version": {
              "description": "Version of the toolset to use",
              "type": "number"
            },
            "license": {
              "description": "License file",
              "type": "string"
            },
            "maxThreadsVivado": {
              "description": "Maximum number of jobs to be execute simultaneously by Vivado",
              "type": "number"
            }
          }
        }
      }
    },
    "blocks": {
      "type": "object",
      "required": ["vivado"],
      "additionalProperties": false,
      "properties": {
        "atf": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["build-srcs"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "type": "object",
                  "required": ["source"],
                  "properties": {
                    "source": {
                      "description": "Git clone URL or path to the ATF project",
                      "type": "string"
                    },
                    "branch": {
                      "description": "Git repository branch",
                      "type": "string"
                    }
                  }
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "devicetree": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["build-srcs", "dependencies"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "type": "object",
                  "required": ["source"],
                  "properties": {
                    "source": {
                      "description": "Git clone URL or path to the Devicetree project",
                      "type": "string"
                    },
                    "branch": {
                      "description": "Git repository branch",
                      "type": "string"
                    }
                  }
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["vivado"],
                  "additionalProperties": false,
                  "properties": {
                    "vivado": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "fsbl": {
          "type": "object",
          "required": ["source", "builder", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["dependencies"],
              "additionalProperties": false,
              "properties": {
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["vivado"],
                  "additionalProperties": false,
                  "properties": {
                    "vivado": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "kernel": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["build-srcs", "add-build-info"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "type": "object",
                  "required": ["source"],
                  "properties": {
                    "source": {
                      "description": "Git clone URL or path to the Kernel project",
                      "type": "string"
                    },
                    "branch": {
                      "description": "Git repository branch",
                      "type": "string"
                    }
                  }
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "add-build-info": {
                  "description": "Switch to specify whether or not build information should be included in the block",
                  "type": "boolean"
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "pmu-fw": {
          "type": "object",
          "required": ["source", "builder", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["dependencies"],
              "additionalProperties": false,
              "properties": {
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["vivado"],
                  "additionalProperties": false,
                  "properties": {
                    "vivado": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "rootfs": {
          "type": "object",
          "required": ["source", "builder", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "release": {
              "description": "Release version of the OS to be built",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["add-build-info", "dependencies"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "type": "object",
                  "required": ["source"],
                  "properties": {
                    "source": {
                      "description": "Git clone URL or path to the root file system project",
                      "type": "string"
                    },
                    "branch": {
                      "description": "Git repository branch",
                      "type": "string"
                    }
                  }
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "add-build-info": {
                  "description": "Switch to specify whether or not build information should be included in the block",
                  "type": "boolean"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["kernel"],
                  "additionalProperties": false,
                  "properties": {
                    "kernel": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "devicetree": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "vivado": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "u-boot": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["build-srcs", "add-build-info", "dependencies"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "type": "object",
                  "required": ["source"],
                  "properties": {
                    "source": {
                      "description": "Git clone URL or path to the U-Boot project",
                      "type": "string"
                    },
                    "branch": {
                      "description": "Git repository branch",
                      "type": "string"
                    }
                  }
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "add-build-info": {
                  "description": "Switch to specify whether or not build information should be included in the block",
                  "type": "boolean"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["atf"],
                  "additionalProperties": false,
                  "properties": {
                    "atf": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "vivado": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["build-srcs"],
              "additionalProperties": false,
              "properties": {
                "build-srcs": {
                  "oneOf": [
                    {
                      "type": "object",
                      "required": ["source"],
                      "properties": {
                        "source": {
                          "description": "Git clone URL or path to the Vivado project",
                          "type": "string"
                        },
                        "branch": {
                          "description": "Git repository branch",
                          "type": "string"
                        }
                      }
                    },
                    {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["source"],
                        "properties": {
                          "source": {
                            "description": "Git clone URL or path to the Vivado project",
                            "type": "string"
                          },
                          "branch": {
                            "description": "Git repository branch",
                            "type": "string"
                          }
                        }
                      }
                    }
                  ]
                },
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "name": {
                  "description": "Name of the project, required by Hog and IPBB",
                  "type": "string"
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        },
        "image": {
          "type": "object",
          "required": ["source", "builder", "project", "container"],
          "additionalProperties": false,
          "properties": {
            "source": {
              "description": "Source for obtaining the block",
              "enum": ["build", "import"]
            },
            "builder": {
              "description": "Builder class to be used",
              "type": "string"
            },
            "project": {
              "type": "object",
              "required": ["dependencies"],
              "additionalProperties": false,
              "properties": {
                "import-src": {
                  "description": "URL or path to the pre-built files",
                  "type": "string"
                },
                "dependencies": {
                  "type": "object",
                  "required": ["atf", "devicetree", "fsbl", "kernel", "pmu-fw", "rootfs", "u-boot", "vivado"],
                  "additionalProperties": false,
                  "properties": {
                    "atf": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "devicetree": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "fsbl": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "kernel": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "pmu-fw": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "rootfs": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "u-boot": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    },
                    "vivado": {
                      "description": "Path to the block package, relative to the project directory",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "container": {
              "type": "object",
              "required": ["image", "tag"],
              "additionalProperties": false,
              "properties": {
                "image": {
                  "description": "Container image to build the block",
                  "type": "string"
                },
                "tag": {
                  "description": "Container image tag",
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}
